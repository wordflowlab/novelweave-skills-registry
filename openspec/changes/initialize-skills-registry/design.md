# Skills Registry Design

## Context

NovelWeave Skills Registry æ˜¯ä¸€ä¸ªåŸºäº GitHub çš„ä¸­å¿ƒåŒ– Skills ç´¢å¼•ç³»ç»Ÿ,ä¸º NovelWeave v0.15.0 çš„ Skills Marketplace æä¾›æ•°æ®æºã€‚

### Background
- NovelWeave å·²å®ç° MCP Marketplace,ä½¿ç”¨è¿œç¨‹é…ç½®åŠ è½½
- Skills Marketplace å¤ç”¨ç›¸åŒçš„æŠ€æœ¯æ ˆå’Œ UI ç»„ä»¶
- ç¤¾åŒºéœ€è¦ä¸€ä¸ªç®€å•ã€é€æ˜çš„ Skills è´¡çŒ®æµç¨‹

### Stakeholders
- **NovelWeave ç”¨æˆ·**: æµè§ˆå’Œå®‰è£… Skills
- **Skill å¼€å‘è€…**: æäº¤å’Œç»´æŠ¤ Skills
- **WordFlow Lab**: å®¡æ ¸å’Œç»´æŠ¤ Registry

## Goals / Non-Goals

### Goals
- âœ… æä¾›ç»Ÿä¸€çš„ Skills å…ƒæ•°æ®ç´¢å¼•
- âœ… è‡ªåŠ¨åŒ–éªŒè¯ PR æäº¤
- âœ… ç®€åŒ–ç¤¾åŒºè´¡çŒ®æµç¨‹
- âœ… ç¡®ä¿ Skills è´¨é‡å’Œå®‰å…¨æ€§
- âœ… æ”¯æŒå®˜æ–¹è®¤è¯æœºåˆ¶

### Non-Goals
- âŒ ä¸æ‰˜ç®¡ Skill å†…å®¹æœ¬èº«(ä»…ç´¢å¼•)
- âŒ ä¸éªŒè¯ Skill åŠŸèƒ½æ˜¯å¦æ­£ç¡®
- âŒ ä¸å¤„ç†ç”¨æˆ·å®‰è£…å’Œä½¿ç”¨
- âŒ ä¸ç»´æŠ¤ç”¨æˆ·è¯„åˆ†å’Œè¯„è®º(æœªæ¥åŠŸèƒ½)

## Decisions

### 1. GitHub ä½œä¸º Registry å¹³å°

**å†³ç­–**: ä½¿ç”¨ GitHub repository + JSON æ–‡ä»¶ä½œä¸º Registry å®ç°

**ç†ç”±**:
- âœ… å…è´¹æ‰˜ç®¡å’Œ CDN (raw.githubusercontent.com)
- âœ… Git ç‰ˆæœ¬æ§åˆ¶å’Œå®¡è®¡å†å²
- âœ… PR å®¡æ ¸æµç¨‹æˆç†Ÿ
- âœ… GitHub Actions å…è´¹ CI/CD
- âœ… å¼€å‘è€…ç†Ÿæ‚‰çš„å·¥ä½œæµ

**å¤‡é€‰æ–¹æ¡ˆ**:
- npm Registry: éœ€è¦å‘å¸ƒæµç¨‹,ç»´æŠ¤æˆæœ¬é«˜
- è‡ªå»º API: éœ€è¦æœåŠ¡å™¨å’Œç»´æŠ¤,æˆæœ¬é«˜
- GitHub Releases: ä¸é€‚åˆç´¢å¼•,æŸ¥è¯¢å›°éš¾

### 2. ä¸‰å±‚éªŒè¯ä½“ç³»

**å†³ç­–**: æ ¼å¼éªŒè¯(è‡ªåŠ¨) + å¯è®¿é—®æ€§éªŒè¯(è‡ªåŠ¨) + è´¨é‡éªŒè¯(äººå·¥)

**ç†ç”±**:
- è‡ªåŠ¨éªŒè¯å‡å°‘äººå·¥å®¡æ ¸è´Ÿæ‹…
- äººå·¥å®¡æ ¸ç¡®ä¿å†…å®¹è´¨é‡å’Œå®‰å…¨æ€§
- åˆ†å±‚è®¾è®¡æä¾›æ¸…æ™°çš„è´£ä»»è¾¹ç•Œ

**å®ç°**:
```
PR æäº¤
  â†“
æ ¼å¼éªŒè¯ (validate-registry.js)
  â†“
å¯è®¿é—®æ€§éªŒè¯ (check-new-skills.js)
  â†“
äººå·¥å®¡æ ¸ (WordFlow Lab)
  â†“
åˆå¹¶å‘å¸ƒ
```

### 3. registry.json Schema

**å†³ç­–**: æ‰å¹³çš„ JSON æ•°ç»„ç»“æ„,åŒ…å«å¿…éœ€å­—æ®µå’Œå¯é€‰å­—æ®µ

**å¿…éœ€å­—æ®µ**: id, type, name, description, repository
**æ¨èå­—æ®µ**: author, category, keywords, version
**ç³»ç»Ÿå­—æ®µ**: downloads, rating, verified, lastUpdated

**ç†ç”±**:
- ç®€å•æ˜“è¯»,æ˜“äºæ‰‹åŠ¨ç¼–è¾‘
- JSON å¹¿æ³›æ”¯æŒ,å·¥å…·é“¾æˆç†Ÿ
- æ‰å¹³ç»“æ„æ–¹ä¾¿éªŒè¯å’ŒæŸ¥è¯¢
- å­—æ®µè®¾è®¡å‚è€ƒ npm package.json

**å¤‡é€‰æ–¹æ¡ˆ**:
- YAML: æ›´æ˜“è¯»ä½†è§£æå™¨å¤šæ ·æ€§é—®é¢˜
- æ•°æ®åº“: è¿‡äºå¤æ‚,è¿èƒŒç®€å•æ€§åŸåˆ™

### 4. Category åˆ†ç±»ç³»ç»Ÿ

**å†³ç­–**: 4 ä¸ªå›ºå®šç±»åˆ«
- `genre-knowledge` - ç±»å‹çŸ¥è¯†
- `writing-techniques` - å†™ä½œæŠ€å·§
- `quality-assurance` - è´¨é‡ä¿è¯
- `workflow-guide` - å·¥ä½œæµæŒ‡å¯¼

**ç†ç”±**:
- è¦†ç›–ä¸»è¦ä½¿ç”¨åœºæ™¯
- é¿å…åˆ†ç±»è¿‡å¤šå¯¼è‡´æ··ä¹±
- å¯é€šè¿‡ keywords å’Œ tags è¡¥å……

### 5. Git å®‰å…¨æªæ–½

**å†³ç­–**: Shallow clone + Sparse checkout + ç¦ç”¨ hooks

```bash
git clone --depth 1 --filter=blob:none --sparse {repo}
git sparse-checkout set SKILL.md "*.md" examples/ templates/
git config core.hooksPath /dev/null
```

**ç†ç”±**:
- å‡å°‘æ”»å‡»é¢
- åŠ å¿«ä¸‹è½½é€Ÿåº¦
- é˜²æ­¢æ¶æ„ Git hooks
- åªä¸‹è½½å¿…è¦æ–‡ä»¶

## Architecture

### Data Flow

```
ç¤¾åŒºè´¡çŒ®è€…
  â†“ (Fork & PR)
GitHub Actions (è‡ªåŠ¨éªŒè¯)
  â†“ (éªŒè¯é€šè¿‡)
WordFlow Lab (äººå·¥å®¡æ ¸)
  â†“ (å®¡æ ¸é€šè¿‡)
registry.json æ›´æ–°
  â†“ (HTTPS)
NovelWeave åŠ è½½
  â†“
ç”¨æˆ·æµè§ˆå’Œå®‰è£…
```

### Component Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GitHub Repository                  â”‚
â”‚                                    â”‚
â”‚  registry.json (æ ¸å¿ƒæ•°æ®)          â”‚
â”‚                                    â”‚
â”‚  â”œâ”€ .github/workflows/             â”‚
â”‚  â”‚    â””â”€ validate-skill.yml        â”‚
â”‚  â”‚                                 â”‚
â”‚  â””â”€ scripts/                       â”‚
â”‚       â”œâ”€ validate-registry.js      â”‚
â”‚       â””â”€ check-new-skills.js       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“ (HTTPS)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NovelWeave                         â”‚
â”‚                                    â”‚
â”‚  RemoteConfigLoader                â”‚
â”‚    â†“                               â”‚
â”‚  MarketplaceManager                â”‚
â”‚    â†“                               â”‚
â”‚  Skills Marketplace UI             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### File Structure

```
novelweave-skills-registry/
â”œâ”€â”€ registry.json              â­ æ ¸å¿ƒæ•°æ®
â”œâ”€â”€ README.md                  ğŸ“– ç”¨æˆ·æ–‡æ¡£
â”œâ”€â”€ CONTRIBUTING.md            ğŸ“– è´¡çŒ®æŒ‡å—
â”œâ”€â”€ LICENSE                    âš–ï¸ MIT License
â”œâ”€â”€ .gitignore
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ validate-skill.yml ğŸ¤– éªŒè¯å·¥ä½œæµ
â””â”€â”€ scripts/
    â”œâ”€â”€ validate-registry.js   âœ… æ ¼å¼éªŒè¯
    â””â”€â”€ check-new-skills.js    âœ… Skill æ£€æµ‹
```

## Risks / Trade-offs

### Risk: GitHub ä¾èµ–
**æè¿°**: å®Œå…¨ä¾èµ– GitHub å¹³å°
**å½±å“**: GitHub å®•æœºæˆ–æ”¿ç­–å˜åŒ–å½±å“å¯ç”¨æ€§
**ç¼“è§£**:
- registry.json æ˜¯çº¯ JSON,æ˜“äºè¿ç§»
- å¯å¿«é€Ÿåˆ‡æ¢åˆ°å…¶ä»– Git æ‰˜ç®¡å¹³å°
- æœ¬åœ°ç¼“å­˜å‡å°‘å®æ—¶ä¾èµ–

### Risk: æ‰‹åŠ¨å®¡æ ¸ç“¶é¢ˆ
**æè¿°**: äººå·¥å®¡æ ¸å¯èƒ½æˆä¸ºç“¶é¢ˆ
**å½±å“**: å®¡æ ¸å‘¨æœŸé•¿å½±å“ç¤¾åŒºç§¯ææ€§
**ç¼“è§£**:
- è®¾å®š 3 ä¸ªå·¥ä½œæ—¥ SLA
- è‡ªåŠ¨åŒ–éªŒè¯å‡å°‘å®¡æ ¸å·¥ä½œé‡
- åŸ¹å…»ç¤¾åŒºå®¡æ ¸å‘˜

### Trade-off: ç®€å•æ€§ vs åŠŸèƒ½ä¸°å¯Œåº¦
**é€‰æ‹©**: ä¼˜å…ˆç®€å•æ€§
**æ”¾å¼ƒ**: å¤æ‚çš„å…ƒæ•°æ®ã€è¯„è®ºç³»ç»Ÿã€è‡ªåŠ¨æ›´æ–°ç»Ÿè®¡
**ç†ç”±**:
- MVP å¿«é€Ÿä¸Šçº¿
- é™ä½ç»´æŠ¤æˆæœ¬
- å¯åœ¨åç»­è¿­ä»£ä¸­å¢å¼º

### Trade-off: ä¸­å¿ƒåŒ– vs å»ä¸­å¿ƒåŒ–
**é€‰æ‹©**: ä¸­å¿ƒåŒ– Registry
**æ”¾å¼ƒ**: å»ä¸­å¿ƒåŒ–å‘ç°æœºåˆ¶
**ç†ç”±**:
- è´¨é‡æ§åˆ¶æ›´å®¹æ˜“
- ç”¨æˆ·ä½“éªŒæ›´å¥½
- æŠ€æœ¯å®ç°æ›´ç®€å•

## Migration Plan

æœ¬ææ¡ˆæ˜¯å…¨æ–°ç³»ç»Ÿ,æ— éœ€è¿ç§»ã€‚

### Rollout Plan

**Phase 1: ä»“åº“åˆå§‹åŒ–** (ç¬¬ 1 å‘¨)
- åˆ›å»º GitHub repository
- åˆå§‹åŒ–æ–‡ä»¶ç»“æ„
- é…ç½® GitHub Actions

**Phase 2: éªŒè¯å·¥ä½œæµ** (ç¬¬ 1 å‘¨)
- å®ç°éªŒè¯è„šæœ¬
- æµ‹è¯• PR å·¥ä½œæµ
- é…ç½® Branch Protection

**Phase 3: åˆå§‹ Skills** (ç¬¬ 2 å‘¨)
- åˆ›å»º 3 ä¸ªå®˜æ–¹ Skill ä»“åº“
- æ·»åŠ åˆ° registry.json
- æµ‹è¯•ç«¯åˆ°ç«¯é›†æˆ

**Phase 4: ç¤¾åŒºå¼€æ”¾** (ç¬¬ 3 å‘¨)
- å‘å¸ƒå…¬å‘Š
- ç›‘æ§å’Œå“åº” PRs
- æ”¶é›†åé¦ˆ

### Rollback Plan

å¦‚æœå‡ºç°ä¸¥é‡é—®é¢˜:
1. æš‚åœ PR åˆå¹¶
2. å›æ»š registry.json åˆ°ä¸Šä¸€ä¸ªç¨³å®šç‰ˆæœ¬
3. NovelWeave å°†ç»§ç»­ä½¿ç”¨ç¼“å­˜æ•°æ®
4. ä¿®å¤é—®é¢˜åæ¢å¤

## Performance Considerations

### registry.json å¤§å°
- ç›®æ ‡: < 500KB
- å®¹é‡: ~1000+ Skills
- åŠ è½½æ—¶é—´: < 2 ç§’

### GitHub Actions è¿è¡Œæ—¶é—´
- ç›®æ ‡: < 3 åˆ†é’Ÿ
- å¹¶è¡ŒéªŒè¯æ–°å¢ Skills
- å¤±è´¥å¿«é€Ÿè¿”å›

### Skill å®‰è£…æ—¶é—´
- Git clone --depth 1: ~3-5 ç§’
- Sparse checkout: å‡å°‘ 50-70% æ•°æ®ä¼ è¾“

## Open Questions

### Q1: å¦‚ä½•å¤„ç† Skill æ›´æ–°é€šçŸ¥?
**è®¨è®º**:
- é€‰é¡¹ A: NovelWeave å®šæœŸæ£€æŸ¥ç‰ˆæœ¬å·å˜åŒ–
- é€‰é¡¹ B: GitHub webhook æ¨é€æ›´æ–°
**å†³å®š**: é€‰é¡¹ A - ç®€å•å¯é ,æ— éœ€é¢å¤–æœåŠ¡

### Q2: æ˜¯å¦éœ€è¦å¼ƒç”¨æµç¨‹?
**è®¨è®º**:
- å¦‚ä½•å¤„ç†ä¸å†ç»´æŠ¤çš„ Skills?
**å»ºè®®**:
- æ·»åŠ  `deprecated: true` å­—æ®µ
- åœ¨ UI ä¸­æ˜¾ç¤ºè­¦å‘Š
- 6 ä¸ªæœˆåç§»é™¤

### Q3: å¦‚ä½•å¤„ç†å‘½åå†²çª?
**è®¨è®º**:
- Skill ID å¿…é¡»å”¯ä¸€
- å¦‚ä½•é¿å…å‘½åæŠ¢æ³¨?
**å»ºè®®**:
- å…ˆåˆ°å…ˆå¾—åŸåˆ™
- é¼“åŠ±ä½¿ç”¨ `author-skill-name` æ ¼å¼
- WordFlow Lab ä¿ç•™å®˜æ–¹å‘½åæƒ

## References

- NovelWeave Agent Skills PRD v0.14
- Skills Marketplace PRD v0.15
- MCP Marketplace å®ç° (src/ui/marketplace/)
- npm Registry è®¾è®¡: https://docs.npmjs.com/cli/v8/using-npm/registry
